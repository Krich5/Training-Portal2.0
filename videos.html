<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Training Videos</title>
<meta name="color-scheme" content="dark">
<style>
  :root{
    --bg:#0b1020; --bg2:#0a132a; --card:#131a2a; --muted:#92a0b8; --fg:#e9edf5; --input:#0e1525;
    --border:rgba(255,255,255,.08); --accentA:#22d3ee; --accentB:#3b82f6; --ok:#34d399;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans";
       background:linear-gradient(180deg,var(--bg),var(--bg2)); color:var(--fg); min-height:100vh}
  header{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:12px;padding:16px 20px;border-bottom:1px solid var(--border)}
  .left{justify-self:start}
  .center{justify-self:center;font-weight:800}
  .right{justify-self:end;color:var(--muted);font-weight:600;text-align:right}
  .btnLink{background:var(--input);color:var(--fg);border:1px solid var(--border);font-weight:800;padding:8px 14px;border-radius:12px;text-decoration:none}
  .wrap{max-width:1280px;margin:26px auto;padding:0 18px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  /* Player */
  h1{margin:0 0 6px 0;font-size:clamp(18px,2vw,22px);color:var(--muted);font-weight:700}
  #player{width:100%;aspect-ratio:16/9;background:#000;border-radius:16px}
  .prog{margin-top:8px;background:var(--input);border:1px solid var(--border);border-radius:999px;overflow:hidden;height:12px}
  .bar{height:100%;width:0%;background:linear-gradient(135deg,var(--accentA),var(--accentB))}
  .row{display:flex;justify-content:space-between;align-items:center;margin-top:8px;gap:10px;flex-wrap:wrap}
  .muted{color:var(--muted)}
  /* Playlist bottom */
  .playlistShell{margin-top:18px}
  .listHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  #playlist{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
  .item{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:var(--input);cursor:pointer;transition:transform .05s ease}
  .item:hover{transform:translateY(-1px)}
  .item.active{outline:2px solid var(--accentB)}
  .badge{font-size:.8rem;color:var(--muted)}
  .badge.done{color:var(--ok);font-weight:700}
</style>
</head>
<body>
  <header>
    <a class="btnLink left" href="select.html">← Back</a>
    <div id="hdr" class="center">Training</div>
    <div id="who" class="right"></div>
  </header>

  <div class="wrap">
    <!-- BIG player card -->
    <section class="card">
      <h1 id="videoTitle">Loading…</h1>
      <video id="player" controls playsinline preload="metadata"
             controlsList="nodownload noremoteplayback" disablepictureinpicture></video>
      <div class="prog" aria-label="overall progress"><div id="bar" class="bar"></div></div>
      <div class="row">
        <div id="progText" class="muted">0/0 completed</div>
        <div id="hint" class="muted"></div>
      </div>
    </section>

    <!-- Playlist at bottom -->
    <section class="card playlistShell">
      <div class="listHeader">
        <h2 style="margin:0">Playlist</h2>
        <div class="muted" id="courseNote"></div>
      </div>
      <div id="playlist"></div>
    </section>
  </div>

<script src="config.js?v=v1"></script>
<script>
  // Gate
  if (sessionStorage.getItem('tp2_ok')!=='1'){ location.href='index.html'; }

  // Read course
  const params = new URLSearchParams(location.search);
  const course = (params.get('course')||'agent').toLowerCase();

  // Tiny profile (optional): show brand at right if you want name/company later
  document.getElementById('who').textContent = window.APP_CONFIG?.BRAND || '';

  // Build playlist lists
  function encodePath(dir, filename){ return dir + '/' + encodeURIComponent(filename); }

  function getPlaylist(c){
    if (c==='agent'){
      const dir = 'AgentVideos';
      const files = [
        'Agent Login.mp4',
        'Profiles Settings.mp4',
        'Agent State.mp4',
        'Answering Interactions.mp4',
        'Blind Transfers.mp4',
        'Consults.mp4',
        'Outbound Calling.mp4',
        'Side Navigation.mp4',
        'Sign Out.mp4'
      ];
      return files.map((f,i)=>({ title: `${i+1}. ${f.replace('.mp4','')}`, src: encodePath(dir,f) }));
    }
    if (c==='supervisor'){
      const dir='SupervisorVideos';
      return [{ title:'Supervisor Intro', src: encodePath(dir,'Intro.mp4')}];
    }
    if (c==='admin'){
      const dir='AdminVideos';
      return [{ title:'Admin Intro', src: encodePath(dir,'Intro.mp4')}];
    }
    if (c==='reporting'){
      const dir='ReportingVideos';
      return [{ title:'Reporting Overview', src: encodePath(dir,'Overview.mp4')}];
    }
    // general
    const dir='GeneralVideos';
    return [{ title:'Welcome', src: encodePath(dir,'Welcome.mp4')}];
  }

  const pretty = s => s.charAt(0).toUpperCase()+s.slice(1);
  const CourseTitle = `${pretty(course)} Training`;
  document.getElementById('hdr').textContent = CourseTitle;
  document.getElementById('courseNote').textContent = CourseTitle;
  document.title = CourseTitle + ' — ' + (window.APP_CONFIG?.BRAND || 'Training');

  // Hooks
  const listEl = document.getElementById('playlist');
  const player = document.getElementById('player');
  const videoTitle = document.getElementById('videoTitle');
  const bar = document.getElementById('bar');
  const progText = document.getElementById('progText');
  const hint = document.getElementById('hint');

  // State
  const vids = getPlaylist(course);
  let idx = 0;
  let completed = new Array(vids.length).fill(false);

  // Render
  function overall(){
    const done = completed.filter(Boolean).length;
    progText.textContent = `${done}/${vids.length} completed`;
    bar.style.width = `${(done/Math.max(1,vids.length))*100}%`;
    hint.textContent = done===vids.length ? 'All Done — feel free to rewatch anything.' : '';
  }

  function renderList(){
    listEl.innerHTML = vids.map((v,i)=>`
      <button class="item ${i===idx?'active':''}" data-i="${i}">
        <span>${v.title}</span>
        <span class="badge ${completed[i]?'done':''}">${completed[i]?'Done':''}</span>
      </button>`).join('');
    listEl.querySelectorAll('.item').forEach(el=>{
      el.addEventListener('click', ()=>{
        const i = Number(el.getAttribute('data-i'));
        if (i === idx){ player.currentTime = 0; player.play(); return; }
        idx = i; loadCurrent(true);
      });
    });
    overall();
  }

  function loadCurrent(autoplay){
    videoTitle.textContent = vids[idx].title.replace(/^\d+\.\s*/,'');
    player.src = vids[idx].src;
    player.onloadedmetadata = ()=>{ if (autoplay) player.play(); };
    renderList();
  }

  // Events
  player.addEventListener('ended', ()=>{
    completed[idx] = true;
    if (idx < vids.length-1){ idx++; loadCurrent(true); }
    overall();
  });

  // Boot
  if (!vids.length){
    videoTitle.textContent = 'No videos found for this playlist.';
  }else{
    loadCurrent(false);
    renderList();
  }
</script>
</body>
</html>
