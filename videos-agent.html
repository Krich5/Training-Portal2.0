<!doctype html>
<html lang="en" data-ready="false">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Agent Training</title>
  <meta name="color-scheme" content="dark">
  <style>
    :root { --bg:#0b1020; --bg2:#0a132a; --card:#131a2a; --muted:#92a0b8; --fg:#e9edf5; --input:#0e1525; --border:rgba(255,255,255,.08); --accentA:#22d3ee; --accentB:#3b82f6; --ok:#34d399; }
    *{box-sizing:border-box}
    html[data-ready="false"] body{opacity:0}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans";
         background:linear-gradient(180deg,var(--bg),var(--bg2)); color:var(--fg); min-height:100vh; transition:opacity .12s ease}
    header{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:12px;padding:16px 20px;border-bottom:1px solid var(--border)}
    .left{justify-self:start}
    .center{justify-self:center;font-weight:800;letter-spacing:.2px}
    .right{justify-self:end;color:var(--muted);font-weight:600;text-align:right}
    .btnLink{background:var(--input);color:var(--fg);border:1px solid var(--border);font-weight:800;padding:8px 14px;border-radius:12px;text-decoration:none}
    .wrap{max-width:1280px;margin:26px auto;padding:0 18px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .playerShell{display:grid;grid-template-columns:1fr;gap:14px}
    h1{margin:0 0 6px 0;font-size:clamp(18px,2vw,22px);color:var(--muted);font-weight:700}
    #player{width:100%;aspect-ratio:16/9;background:#000;border-radius:16px}
    .prog{margin-top:8px;background:var(--input);border:1px solid var(--border);border-radius:999px;overflow:hidden;height:12px}
    .bar{height:100%;width:0%;background:linear-gradient(135deg,var(--accentA),var(--accentB))}
    .row{display:flex;justify-content:space-between;align-items:center;margin-top:8px;gap:10px;flex-wrap:wrap}
    .muted{color:var(--muted)}
    .playlistShell{margin-top:18px}
    .listHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    #playlist{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
    .item{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:var(--input);cursor:pointer;transition:transform .05s ease}
    .item:hover{transform:translateY(-1px)}
    .item.active{outline:2px solid var(--accentB)}
    .badge{font-size:.8rem;color:var(--muted)}
    .badge.done{color:var(--ok);font-weight:700}
  </style>
  <script src="config.js?v=v4" defer></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      // Auth gate
      if (!sessionStorage.getItem('portal_auth')) { location.replace('index.html'); return; }

      const BRAND = (window.APP_CONFIG && window.APP_CONFIG.BRAND) || 'Training Portal';
      document.title = BRAND + ' — Agent Training';
      document.getElementById('hdr').textContent = 'Agent Training';
      document.documentElement.setAttribute('data-ready','true');

      // ------- Playlist (Agent) -------
      const srcBase = 'AgentVideos/';
      const vids = [
        { title:'1. Agent login',            file:'Agent Login.mp4' },
        { title:'2. Profile settings',       file:'Profiles Settings.mp4' },
        { title:'3. Agent state',            file:'Agent State.mp4' },
        { title:'4. Outbound calling',       file:'Outbound Calling.mp4' },
        { title:'5. Side navigation',        file:'Side Navigation.mp4' },
        { title:'6. Answering interactions', file:'Answering Interactions.mp4' },
        { title:'7. Consults',               file:'Consults.mp4' },
        { title:'8. Blind transfers',        file:'Blind Transfers.mp4' },
        { title:'9. Sign out',               file:'Sign Out.mp4' }
      ];

      // UI hooks
      const listEl   = document.getElementById('playlist');
      const player   = document.getElementById('player');
      const videoTitle = document.getElementById('videoTitle');
      const bar = document.getElementById('bar');
      const progText = document.getElementById('progText');
      const hint = document.getElementById('hint');
      const courseNote = document.getElementById('courseNote');

      // State
      let idx = 0;
      let completed = new Array(vids.length).fill(false);

      function overall(){
        const done = completed.filter(Boolean).length;
        progText.textContent = `${done}/${vids.length} completed`;
        bar.style.width = `${(done/Math.max(1,vids.length))*100}%`;
        hint.textContent = done===vids.length ? 'All Done — feel free to rewatch anything.' : '';
      }

      function renderList(){
        listEl.innerHTML = vids.map((v,i)=>`
          <button class="item ${i===idx?'active':''}" data-i="${i}">
            <span>${v.title}</span>
            <span class="badge ${completed[i]?'done':''}">${completed[i]?'Done':''}</span>
          </button>`).join('');
        listEl.querySelectorAll('.item').forEach(el=>{
          el.addEventListener('click', ()=>{
            const i = Number(el.getAttribute('data-i'));
            idx = i; loadCurrent(true);
          });
        });
        overall();
      }

      function loadCurrent(autoplay){
        const v = vids[idx];
        videoTitle.textContent = v.title;
        player.src = srcBase + encodeURI(v.file);
        player.onloadedmetadata = ()=>{ if (autoplay) player.play(); };
        renderList();
      }

      player.addEventListener('ended', ()=>{
        completed[idx] = true;
        if (idx < vids.length - 1) idx++;
        loadCurrent(true);
      });

      // Boot
      courseNote.textContent = 'Agent';
      loadCurrent(false);
      renderList();
    });
  </script>
</head>
<body>
  <header>
    <div class="left"><a class="btnLink" href="select.html">← Back</a></div>
    <div class="center" id="hdr">Loading…</div>
    <div class="right"></div>
  </header>

  <div class="wrap">
    <section class="card playerShell">
      <div>
        <h1 id="videoTitle">Loading…</h1>
        <video id="player" controls playsinline preload="metadata"
               controlsList="nodownload noremoteplayback"
               disablepictureinpicture></video>
        <div class="prog" aria-label="overall progress"><div id="bar" class="bar"></div></div>
        <div class="row">
          <div id="progText" class="muted">0/0 completed</div>
          <div id="hint" class="muted"></div>
        </div>
      </div>
    </section>

    <section class="card playlistShell">
      <div class="listHeader">
        <h2 style="margin:0">Playlist</h2>
        <div class="muted" id="courseNote"></div>
      </div>
      <div id="playlist"></div>
    </section>
  </div>
</body>
</html>
